{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
<style>
    .statistics-container {
        padding: 20px;
        background: #f8f9fa;
        min-height: 100vh;
    }
    
    .stats-section {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 25px;
    }
    
    .section-title {
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 20px;
        color: #333;
        border-bottom: 2px solid #4CAF50;
        padding-bottom: 10px;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .stat-item {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        border-left: 4px solid #4CAF50;
    }
    
    .stat-value {
        font-size: 2rem;
        font-weight: bold;
        color: #4CAF50;
        margin-bottom: 5px;
    }
    
    .stat-label {
        color: #666;
        font-size: 0.9rem;
    }
    
    .chart-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
    }
    
    .chart-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
    }
    
    .chart-title {
        font-weight: bold;
        margin-bottom: 15px;
        color: #333;
    }
    
    .progress-container {
        margin: 15px 0;
    }
    
    .progress-label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 0.9rem;
    }
    
    .progress-bar {
        width: 100%;
        height: 15px;
        background: #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4CAF50, #45a049);
        transition: width 0.3s ease;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    .stats-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    
    .stats-table th,
    .stats-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #eee;
    }
    
    .stats-table th {
        background: #4CAF50;
        color: white;
        font-weight: bold;
    }
    
    .stats-table tr:nth-child(even) {
        background: #f8f9fa;
    }
    
    .stats-table tr:hover {
        background: #e8f5e8;
    }
    
    .back-btn {
        background: #4CAF50;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        text-decoration: none;
        display: inline-block;
        margin-bottom: 20px;
    }
    
    .back-btn:hover {
        background: #45a049;
        color: white;
        text-decoration: none;
    }
    
    .metric-highlight {
        background: linear-gradient(135deg, #4CAF50, #45a049);
        color: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin: 20px 0;
    }
    
    .metric-highlight .highlight-value {
        font-size: 3rem;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .metric-highlight .highlight-label {
        font-size: 1.2rem;
        opacity: 0.9;
    }
</style>
{% endblock %}

{% block content %}
<div class="statistics-container">
    <a href="{% url 'admin:courses_dashboard' %}" class="back-btn">‚Üê Back to Dashboard</a>
    
    <h1 style="margin-bottom: 30px; color: #333;">üìà Detailed Statistics</h1>
    
    <!-- Course Statistics -->
    <div class="stats-section">
        <div class="section-title">üìö Course Statistics</div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ course_stats.total_courses }}</div>
                <div class="stat-label">Total Courses</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ course_stats.active_courses }}</div>
                <div class="stat-label">Active Courses</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">${{ course_stats.avg_price|floatformat:2 }}</div>
                <div class="stat-label">Average Price</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ course_stats.total_lessons }}</div>
                <div class="stat-label">Total Lessons</div>
            </div>
        </div>
    </div>
    
    <!-- Enrollment Statistics -->
    <div class="stats-section">
        <div class="section-title">üë• Enrollment Statistics</div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ enrollment_stats.total_enrollments }}</div>
                <div class="stat-label">Total Enrollments</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ enrollment_stats.trial_enrollments }}</div>
                <div class="stat-label">Trial Enrollments</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ enrollment_stats.full_enrollments }}</div>
                <div class="stat-label">Full Enrollments</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ enrollment_stats.this_month }}</div>
                <div class="stat-label">This Month</div>
            </div>
        </div>
        
        <div class="chart-grid">
            <div class="chart-box">
                <div class="chart-title">Enrollment Distribution</div>
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Trial Enrollments</span>
                        <span>{{ enrollment_stats.trial_enrollments }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% widthratio enrollment_stats.trial_enrollments enrollment_stats.total_enrollments 100 %}%"></div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Full Enrollments</span>
                        <span>{{ enrollment_stats.full_enrollments }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% widthratio enrollment_stats.full_enrollments enrollment_stats.total_enrollments 100 %}%"></div>
                    </div>
                </div>
            </div>
            
            <div class="chart-box">
                <div class="chart-title">Monthly Growth</div>
                <div class="metric-highlight">
                    <div class="highlight-value">{{ enrollment_stats.this_month }}</div>
                    <div class="highlight-label">Enrollments This Month</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Revenue Statistics -->
    <div class="stats-section">
        <div class="section-title">üí∞ Revenue Statistics</div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">${{ revenue_stats.total_revenue|floatformat:2 }}</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">${{ revenue_stats.avg_revenue_per_course|floatformat:2 }}</div>
                <div class="stat-label">Avg Revenue per Course</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">${{ revenue_stats.trial_revenue|floatformat:2 }}</div>
                <div class="stat-label">Trial Revenue</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">${{ revenue_stats.full_revenue|floatformat:2 }}</div>
                <div class="stat-label">Full Course Revenue</div>
            </div>
        </div>
    </div>
    
    <!-- Instructor Statistics -->
    <div class="stats-section">
        <div class="section-title">üë®‚Äçüè´ Instructor Statistics</div>
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value">{{ instructor_stats.total_instructors }}</div>
                <div class="stat-label">Total Instructors</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ instructor_stats.active_instructors }}</div>
                <div class="stat-label">Active Instructors</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ instructor_stats.avg_courses_per_instructor|floatformat:1 }}</div>
                <div class="stat-label">Avg Courses per Instructor</div>
            </div>
        </div>
        
        <div class="chart-grid">
            <div class="chart-box">
                <div class="chart-title">Instructor Activity</div>
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Active Instructors</span>
                        <span>{{ instructor_stats.active_instructors }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% widthratio instructor_stats.active_instructors instructor_stats.total_instructors 100 %}%"></div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>Inactive Instructors</span>
                        <span>{{ instructor_stats.total_instructors|add:"-"|add:instructor_stats.active_instructors }}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {% widthratio instructor_stats.total_instructors|add:"-"|add:instructor_stats.active_instructors instructor_stats.total_instructors 100 %}%"></div>
                    </div>
                </div>
            </div>
            
            <div class="chart-box">
                <div class="chart-title">Course Distribution</div>
                <div class="metric-highlight">
                    <div class="highlight-value">{{ instructor_stats.avg_courses_per_instructor|floatformat:1 }}</div>
                    <div class="highlight-label">Courses per Instructor</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Metrics -->
    <div class="stats-section">
        <div class="section-title">üìä Performance Metrics</div>
        <div class="table-container">
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Value</th>
                        <th>Percentage</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Course Completion Rate</td>
                        <td>{{ enrollment_stats.full_enrollments }}</td>
                        <td>{% widthratio enrollment_stats.full_enrollments enrollment_stats.total_enrollments 100 %}%</td>
                        <td>
                            {% if enrollment_stats.full_enrollments > enrollment_stats.trial_enrollments %}
                                <span style="color: green;">‚úì Good</span>
                            {% else %}
                                <span style="color: orange;">‚ö† Needs Attention</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Trial to Full Conversion</td>
                        <td>{{ enrollment_stats.full_enrollments }}</td>
                        <td>{% widthratio enrollment_stats.full_enrollments enrollment_stats.trial_enrollments 100 %}%</td>
                        <td>
                            {% if enrollment_stats.full_enrollments > enrollment_stats.trial_enrollments %}
                                <span style="color: green;">‚úì High</span>
                            {% else %}
                                <span style="color: red;">‚úó Low</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Average Revenue per Student</td>
                        <td>${{ revenue_stats.total_revenue|floatformat:2 }}</td>
                        <td>-</td>
                        <td>
                            {% if revenue_stats.total_revenue > 0 %}
                                <span style="color: green;">‚úì Profitable</span>
                            {% else %}
                                <span style="color: red;">‚úó No Revenue</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td>Instructor Utilization</td>
                        <td>{{ instructor_stats.active_instructors }}/{{ instructor_stats.total_instructors }}</td>
                        <td>{% widthratio instructor_stats.active_instructors instructor_stats.total_instructors 100 %}%</td>
                        <td>
                            {% if instructor_stats.active_instructors > instructor_stats.total_instructors|add:"-"|add:instructor_stats.active_instructors %}
                                <span style="color: green;">‚úì High</span>
                            {% else %}
                                <span style="color: orange;">‚ö† Moderate</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animate progress bars
    const progressBars = document.querySelectorAll('.progress-fill');
    progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
            bar.style.width = width;
        }, 500);
    });
    
    // Animate stat values
    const statValues = document.querySelectorAll('.stat-value');
    statValues.forEach(stat => {
        const finalValue = stat.textContent;
        const isCurrency = finalValue.includes('$');
        const numericValue = parseFloat(finalValue.replace(/[$,]/g, ''));
        
        if (!isNaN(numericValue)) {
            let currentValue = 0;
            const increment = numericValue / 50;
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= numericValue) {
                    currentValue = numericValue;
                    clearInterval(timer);
                }
                
                if (isCurrency) {
                    stat.textContent = '$' + currentValue.toFixed(2);
                } else {
                    stat.textContent = Math.floor(currentValue);
                }
            }, 30);
        }
    });
});
</script>
{% endblock %} 